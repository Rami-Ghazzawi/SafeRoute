<?php
session_start();
if (!isset($_SESSION['username'])) {
    header("Location: login.html");
    exit();
}

include 'db_connect.php';

if (isset($_POST['reset'])) {
    // حذف جميع الحواجز الحالية
    $conn->query("DELETE FROM checkpoints_status");
    
    // إعادة إضافة الحواجز الافتراضية
    $defaultCheckpoints = [
        // نابلس (8 حواجز)
        ['دير شرف', 'دير شرف', 'نابلس', 'سالكة', 'دائم'],
        ['شافي شمرون', 'شافي شمرون', 'نابلس', 'مزدحمة', 'عسكري'],
        ['بيت فوريك', 'بيت فوريك', 'نابلس', 'سالكة', 'دائم'],
        ['المربعة', 'المربعة', 'نابلس', 'مغلقة', 'دائم'],
        ['عورتا', 'عورتا', 'نابلس', 'سالكة', 'دائم'],
        ['عصيرة', 'عصيرة', 'نابلس', 'مزدحمة', 'دائم'],
        ['صرة', 'صرة', 'نابلس', 'سالكة', 'عسكري'],
        ['حوارة', 'حوارة', 'نابلس', 'مغلقة', 'دائم'],
        
        // رام الله (4 حواجز)
        ['الجلزون', 'الجلزون', 'رام الله', 'سالكة', 'عسكري'],
        ['DCO', 'DCO', 'رام الله', 'مزدحمة', 'دائم'],
        ['عين سينيا', 'عين سينيا', 'رام الله', 'سالكة', 'دائم'],
        ['بوابة عطارة', 'بوابة عطارة', 'رام الله', 'مزدحمة', 'دائم'],
        
        // طولكرم (7 حواجز)
        ['بزاريا', 'بزاريا', 'طولكرم', 'سالكة', 'دائم'],
        ['عناب', 'عناب', 'طولكرم', 'مزدحمة', 'دائم'],
        ['سناعوز', 'سناعوز', 'طولكرم', 'سالكة', 'عسكري'],
        ['إيال', 'إيال', 'طولكرم', 'مغلقة', 'دائم'],
        ['جبارة', 'جبارة', 'طولكرم', 'سالكة', 'دائم'],
        ['قفين', 'قفين', 'طولكرم', 'مزدحمة', 'دائم'],
        ['كفر اللبد', 'كفر اللبد', 'طولكرم', 'سالكة', 'دائم'],
        
        // القدس (10 حواجز)
        ['كفر عقب', 'كفر عقب', 'القدس', 'مزدحمة', 'دائم'],
        ['قلنديا', 'قلنديا', 'القدس', 'مزدحمة', 'دائم'],
        ['جبع', 'جبع', 'القدس', 'سالكة', 'دائم'],
        ['حزمة', 'حزمة', 'القدس', 'مغلقة', 'عسكري'],
        ['عناتا', 'عناتا', 'القدس', 'سالكة', 'دائم'],
        ['الرام', 'الرام', 'القدس', 'مزدحمة', 'دائم'],
        ['معالي ادوميم', 'معالي ادوميم', 'القدس', 'مغلقة', 'عسكري'],
        ['العيزرية', 'العيزرية', 'القدس', 'سالكة', 'دائم'],
        ['العيساوية', 'العيساوية', 'القدس', 'مزدحمة', 'دائم'],
        ['شعفاط', 'شعفاط', 'القدس', 'سالكة', 'دائم'],
        
        // الخليل (7 حواجز)
        ['راس الجورة', 'راس الجورة', 'الخليل', 'سالكة', 'دائم'],
        ['فرش الهوى', 'فرش الهوى', 'الخليل', 'مزدحمة', 'دائم'],
        ['الفحص', 'الفحص', 'الخليل', 'مزدحمة', 'دائم'],
        ['جسر حلحول', 'جسر حلحول', 'الخليل', 'سالكة', 'دائم'],
        ['العروب', 'العروب', 'الخليل', 'مغلقة', 'عسكري'],
        ['الظاهرية', 'الظاهرية', 'الخليل', 'سالكة', 'دائم'],
        ['بني نعيم', 'بني نعيم', 'الخليل', 'مزدحمة', 'دائم'],
        
        // جنين (4 حواجز)
        ['دوتان', 'دوتان', 'جنين', 'سالكة', 'عسكري'],
        ['الجلمة', 'الجلمة', 'جنين', 'مغلقة', 'دائم'],
        ['حومش', 'حومش', 'جنين', 'سالكة', 'دائم'],
        ['برطعة', 'برطعة', 'جنين', 'مزدحمة', 'دائم'],
        
        // قلقيلية (6 حواجز)
        ['عزون', 'عزون', 'قلقيلية', 'سالكة', 'دائم'],
        ['الفندق', 'الفندق', 'قلقيلية', 'مزدحمة', 'دائم'],
        ['كدوميم', 'كدوميم', 'قلقيلية', 'مغلقة', 'عسكري'],
        ['كفر لاقف', 'كفر لاقف', 'قلقيلية', 'سالكة', 'دائم'],
        ['النبي الياس', 'النبي الياس', 'قلقيلية', 'مزدحمة', 'دائم'],
        ['حبلة', 'حبلة', 'قلقيلية', 'سالكة', 'دائم'],
        
        // سلفيت (6 حواجز)
        ['ديراستيا', 'ديراستيا', 'سلفيت', 'سالكة', 'دائم'],
        ['بوابة حارس', 'بوابة حارس', 'سلفيت', 'مغلقة', 'عسكري'],
        ['دير بلوط', 'دير بلوط', 'سلفيت', 'سالكة', 'دائم'],
        ['مردا', 'مردا', 'سلفيت', 'مزدحمة', 'دائم'],
        ['ارائيل', 'ارائيل', 'سلفيت', 'مغلقة', 'عسكري'],
        ['زعترة', 'زعترة', 'سلفيت', 'سالكة', 'دائم']
    ];

    foreach ($defaultCheckpoints as $checkpoint) {
        $sql = "INSERT INTO checkpoints_status (name, location_name, area, status, checkpoint_type) 
                VALUES (?, ?, ?, ?, ?)";
        $stmt = $conn->prepare($sql);
        $stmt->bind_param("sssss", $checkpoint[0], $checkpoint[1], $checkpoint[2], $checkpoint[3], $checkpoint[4]);
        $stmt->execute();
        $stmt->close();
    }
    
    $message = "✅ تم إعادة تعيين الحواجز إلى 52 حاجز افتراضي";
}
?>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>إعادة تعيين الحواجز</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <h1><i class="fas fa-redo"></i> إعادة تعيين الحواجز</h1>
        <div class="header-buttons">
            <a href="admin.php" class="btn">العودة للوحة التحكم</a>
            <a href="index.php" class="btn">الصفحة الرئيسية</a>
        </div>
    </header>

    <div class="container">
        <?php if (isset($message)): ?>
        <div class="alert alert-success"><?= $message ?></div>
        <?php endif; ?>

        <div style="text-align: center; padding: 3rem;">
            <div style="background: white; padding: 2rem; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #f39c12; margin-bottom: 1rem;"></i>
                <h2>إعادة تعيين الحواجز</h2>
                <p style="margin: 1rem 0; color: #666;">
                    هذا الإجراء سيمسح جميع الحواجز الحالية ويعيد إضافة الـ 52 حاجز الافتراضي فقط.
                </p>
                <form method="POST">
                    <button type="submit" name="reset" class="btn" style="background: #e74c3c;" 
                            onclick="return confirm('⚠️ هل أنت متأكد؟ هذا الإجراء لا يمكن التراجع عنه!')">
                        <i class="fas fa-trash"></i> إعادة التعيين إلى 52 حاجز
                    </button>
                </form>
            </div>
        </div>
    </div>
</body>
</html>